# ๐๏ธ ะัะบะพะฒะพะดััะฒะพ ะฟะพ ะะพะปะพัะพะฒัะผ ะะฒะพะฝะบะฐะผ WindexsAI

## ๐ฏ ะะฑะทะพั

ะกะธััะตะผะฐ ะณะพะปะพัะพะฒัั ะทะฒะพะฝะบะพะฒ WindexsAI ะพะฑะตัะฟะตัะธะฒะฐะตั real-time ะพะฑัะตะฝะธะต ั AI-ะฐััะธััะตะฝัะพะผ ัะตัะตะท ะณะพะปะพั. ะะธะทะบะฐั ะทะฐะดะตัะถะบะฐ (<500ms), ะฟัะพัะตััะธะพะฝะฐะปัะฝะพะต ะบะฐัะตััะฒะพ, ะธะฝัะตะณัะฐัะธั ั DeepSeek LLM.

## ๐๏ธ ะััะธัะตะบัััะฐ

### ะะพะผะฟะพะฝะตะฝัั

1. **STT Backend** (Speech-to-Text) - ะฟะพัั 2700
   - WebSocket ัะตัะฒะตั ะดะปั real-time ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั ัะตัะธ
   - ะัะฟะพะปัะทัะตั Vosk ะดะปั offline STT
   - ะะฝัะตะณัะฐัะธั ั DeepSeek LLM ะดะปั ะณะตะฝะตัะฐัะธะธ ะพัะฒะตัะพะฒ
   - VAD (Voice Activity Detection) ะดะปั ะพะฟัะตะดะตะปะตะฝะธั ะฟะฐัะท

2. **TTS Service** (Text-to-Speech) - ะฟะพัั 8002
   - FastAPI ัะตัะฒะตั ะดะปั ัะธะฝัะตะทะฐ ัะตัะธ
   - ะัะฟะพะปัะทัะตั Silero TTS (ััััะบะธะน/ะฐะฝะณะปะธะนัะบะธะน)
   - ะะฝะพะถะตััะฒะพ ะณะพะปะพัะพะฒ ะธ ัะผะพัะธะน
   - ะััะพะบะฐั ัะบะพัะพััั ะณะตะฝะตัะฐัะธะธ

3. **Frontend Component** (`VoiceCall.tsx`)
   - React ะบะพะผะฟะพะฝะตะฝั ะดะปั UI ะณะพะปะพัะพะฒัั ะทะฒะพะฝะบะพะฒ
   - WebRTC ะดะปั ะทะฐัะฒะฐัะฐ ะผะธะบัะพัะพะฝะฐ
   - AudioWorklet ะดะปั ะพะฑัะฐะฑะพัะบะธ PCM ะฐัะดะธะพ
   - ะฃะฟัะฐะฒะปะตะฝะธะต ัะพััะพัะฝะธะตะผ ะทะฒะพะฝะบะฐ

### ะะพัะพะบ ะดะฐะฝะฝัั

```
โโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ         โโโโโโโโโโโโ
โ ะะธะบัะพัะพะฝ โ โโPCMโโ>โ AudioWorklet โ โโWSโโ> โ STT Backend โ โโAPIโโ>โ DeepSeek โ
โโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ         โโโโโโโโโโโโ
                                                      โ                      โ
                                                      โ                      โ
                                                      โผ                      โผ
โโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ         โโโโโโโโโโโโ
โ ะะธะฝะฐะผะธะบะธ โ <โโWAVโโโ Audio Player โ <โโWSโโ โ TTS Service โ <โโAPIโโโ LLM Text โ
โโโโโโโโโโโโ         โโโโโโโโโโโโโโโโ         โโโโโโโโโโโโโโโ         โโโโโโโโโโโโ
```

## ๐ ะฃััะฐะฝะพะฒะบะฐ ะธ ะะฐะฟััะบ

### 1. ะฃััะฐะฝะพะฒะบะฐ ะทะฐะฒะธัะธะผะพััะตะน

```bash
# Backend (Python)
cd voice-backend
pip3 install -r requirements.txt

cd stt
pip3 install -r requirements.txt
```

### 2. ะกะบะฐัะธะฒะฐะฝะธะต Vosk ะผะพะดะตะปะธ

```bash
cd voice-backend/models
wget https://alphacephei.com/vosk/models/vosk-model-small-ru-0.22.zip
unzip vosk-model-small-ru-0.22.zip
```

### 3. ะะพะฝัะธะณััะฐัะธั

ะะฐัััะพะนัะต `.env` ัะฐะนะปั:

#### `voice-backend/stt/.env`
```env
LLM_API_KEY=your-deepseek-api-key
MODEL_PATH=/path/to/vosk-model-small-ru-0.22
TTS_BASE_URL=http://127.0.0.1:8002
```

#### `voice-backend/.env`
```env
TEMP_DIR=/path/to/temp_audio
REALTIME_MODE=1
```

### 4. ะะฐะฟััะบ ะฒัะตั ัะตัะฒะธัะพะฒ

#### ะะฐัะธะฐะฝั 1: ะะฒัะพะผะฐัะธัะตัะบะธะน ะทะฐะฟััะบ

```bash
cd voice-backend
./start_voice_backend.sh
```

ะกะบัะธะฟั ะฐะฒัะพะผะฐัะธัะตัะบะธ:
- ะัะพะฒะตัะธั ะฝะฐะปะธัะธะต Vosk ะผะพะดะตะปะธ (ัะบะฐัะฐะตั ะตัะปะธ ะฝัะถะฝะพ)
- ะฃััะฐะฝะพะฒะธั ะฒัะต ะทะฐะฒะธัะธะผะพััะธ
- ะะฐะฟัััะธั TTS Service (ะฟะพัั 8002)
- ะะฐะฟัััะธั STT Backend (ะฟะพัั 2700)
- ะกะพะทะดะฐัั ะปะพะณ-ัะฐะนะปั

#### ะะฐัะธะฐะฝั 2: ะััะฝะพะน ะทะฐะฟััะบ

```bash
# ะขะตัะผะธะฝะฐะป 1: TTS Service
cd voice-backend
python3 app.py

# ะขะตัะผะธะฝะฐะป 2: STT Backend
cd voice-backend/stt
python3 server_fixed.py

# ะขะตัะผะธะฝะฐะป 3: Frontend (ะตัะปะธ ะตัะต ะฝะต ะทะฐะฟััะตะฝ)
npm run dev
```

### 5. ะััะฐะฝะพะฒะบะฐ ัะตัะฒะธัะพะฒ

```bash
cd voice-backend
./stop_voice_backend.sh
```

## ๐ฎ ะัะฟะพะปัะทะพะฒะฐะฝะธะต

### ะะตะฑ-ะธะฝัะตััะตะนั

1. ะัะบัะพะนัะต ะฟัะธะปะพะถะตะฝะธะต: `http://127.0.0.1:8081`
2. ะะตัะตะนะดะธัะต ะฝะฐ ัััะฐะฝะธัั Chat
3. ะะฐะถะผะธัะต ะบะฝะพะฟะบั "๐๏ธ ะะพะปะพัะพะฒะพะน ะทะฒะพะฝะพะบ"
4. ะะฐะถะผะธัะต "ะะฐัะฐัั ะทะฒะพะฝะพะบ"
5. ะะฐะทัะตัะธัะต ะดะพัััะฟ ะบ ะผะธะบัะพัะพะฝั
6. ะะพะฒะพัะธัะต ั AI-ะฐััะธััะตะฝัะพะผ!

### ะญะปะตะผะตะฝัั ัะฟัะฐะฒะปะตะฝะธั

- **ะะฐัะฐัั ะทะฒะพะฝะพะบ** - ะธะฝะธัะธะธััะตั ะณะพะปะพัะพะฒะพะต ัะพะตะดะธะฝะตะฝะธะต
- **ะะฐะฒะตััะธัั** - ะทะฐะฒะตััะฐะตั ะทะฒะพะฝะพะบ
- **ะัะบะปััะธัั ะผะธะบัะพัะพะฝ** - ะพัะบะปััะฐะตั ะฟะตัะตะดะฐัั ะฐัะดะธะพ (mute)
- **ะัะบะปััะธัั ะทะฒัะบ** - ะพัะบะปััะฐะตั ะฒะพัะฟัะพะธะทะฒะตะดะตะฝะธะต ะพัะฒะตัะพะฒ

### ะะฝะดะธะบะฐัะพัั ัะพััะพัะฝะธั

- ๐ข **ะะพะดะบะปััะตะฝะพ** - WebSocket ัะพะตะดะธะฝะตะฝะธะต ัััะฐะฝะพะฒะปะตะฝะพ
- ๐ก **ะะพะดะบะปััะตะฝะธะต...** - ะธะดะตั ะฟะพะดะบะปััะตะฝะธะต
- ๐ด **ะัะธะฑะบะฐ** - ะฟัะพะฑะปะตะผั ั ะฟะพะดะบะปััะตะฝะธะตะผ
- ๐ค **ะะพัะพะฒ ะบ ัะฐะทะณะพะฒะพัั** - ะพะถะธะดะฐะตั ะฒะฐัะตะน ัะตัะธ
- ๐ **ะกะปััะฐั...** - ัะฐัะฟะพะทะฝะฐะตััั ัะตัั
- ๐ฃ๏ธ **ะัะฒะตัะฐั...** - AI ะณะตะฝะตัะธััะตั ะพัะฒะตั

## ๐ง ะขะตัะฝะธัะตัะบะฐั ะดะพะบัะผะตะฝัะฐัะธั

### WebSocket ะัะพัะพะบะพะป

#### ะะปะธะตะฝั โ ะกะตัะฒะตั

**ะะพะฝัะธะณััะฐัะธั (ะฟัะธ ะฟะพะดะบะปััะตะฝะธะธ):**
```json
{
  "config": {
    "sample_rate": 16000,
    "words": false
  }
}
```

**ะัะดะธะพ ะดะฐะฝะฝัะต:**
- Binary frames: PCM 16-bit mono 16kHz
- Chunk size: 640 bytes (20ms)

**ะะพะผะฐะฝะดั:**
```json
{ "reset": 1 }  // ะคะธะฝะฐะปะธะทะธัะพะฒะฐัั ัะตะบัััั ััะฐะทั
{ "eof": 1 }    // ะะฐะฒะตััะธัั ัะตััะธั
{ "ping": 1234567890 }  // Keep-alive
```

#### ะกะตัะฒะตั โ ะะปะธะตะฝั

**ะกัะฐััั:**
```json
{
  "event": "ready",
  "sample_rate": 16000,
  "frame_ms": 20
}
```

**ะะฐัะฟะพะทะฝะฐะฒะฐะฝะธะต ัะตัะธ:**
```json
{
  "type": "partial",
  "partial": "ะัะธะฒะตั ะบะฐะบ ะด"
}

{
  "type": "final",
  "text": "ะัะธะฒะตั ะบะฐะบ ะดะตะปะฐ"
}
```

**LLM ะัะฒะตั:**
```json
{
  "type": "llm_start",
  "utterance_id": 1
}

{
  "type": "llm_delta",
  "delta": "ะัะธะฒะตั",
  "utterance_id": 1
}

{
  "type": "llm_end",
  "utterance_id": 1
}
```

**TTS ะัะดะธะพ:**
```json
{
  "type": "tts_start",
  "utterance_id": 1
}
```

Binary audio frames (WAV format with AUD0 header):
```
Header (14 bytes):
- Magic: "AUD0" (4 bytes)
- Utterance ID: uint32 (4 bytes)
- MIME type: uint16 (2 bytes, 1 = WAV)
- Payload length: uint32 (4 bytes)
- Payload: WAV data
```

```json
{
  "type": "tts_end",
  "utterance_id": 1
}
```

### TTS HTTP API

**Endpoint:** `POST /tts`

**Request:**
```json
{
  "text": "ะัะธะฒะตั, ะผะธั!",
  "model": "silero_ru",
  "voice": "eugene",
  "speed": 1.0,
  "emotion": "neutral",
  "pause_between_sentences": 0.12
}
```

**Response:**
```json
{
  "success": true,
  "audio_url": "/audio/12345.wav",
  "duration": 2.5,
  "sample_rate": 48000,
  "file_size": 120000
}
```

### ะะพัััะฟะฝัะต ะณะพะปะพัะฐ

**ะัััะบะธะน (silero_ru):**
- `eugene` - ะผัะถัะบะพะน, ะฝะตะนััะฐะปัะฝัะน (ะฟะพ ัะผะพะปัะฐะฝะธั)
- `aidar` - ะผัะถัะบะพะน, ัะฝะตัะณะธัะฝัะน
- `xenia` - ะถะตะฝัะบะธะน, ะผัะณะบะธะน
- `baya` - ะถะตะฝัะบะธะน, ัะผะพัะธะพะฝะฐะปัะฝัะน
- `kseniya` - ะถะตะฝัะบะธะน, ะฟัะพัะตััะธะพะฝะฐะปัะฝัะน

**ะะฝะณะปะธะนัะบะธะน (silero_en):**
- `en_0` to `en_15` - ัะฐะทะปะธัะฝัะต ะณะพะปะพัะฐ

### ะญะผะพัะธะธ

- `neutral` - ะฝะตะนััะฐะปัะฝะฐั (ะฟะพ ัะผะพะปัะฐะฝะธั)
- `happy` - ัะฐะดะพััะฝะฐั
- `sad` - ะณััััะฝะฐั
- `angry` - ัะตัะดะธัะฐั

## ๐ ะัะพะธะทะฒะพะดะธัะตะปัะฝะพััั

### ะะฐะดะตัะถะบะธ

- **STT (Speech-to-Text):** ~200-500ms
- **LLM (DeepSeek):** ~1-3s ะดะปั ะฟะตัะฒะพะณะพ ัะพะบะตะฝะฐ
- **TTS (Silero):** ~500ms-1s
- **ะะฑัะฐั ะทะฐะดะตัะถะบะฐ:** ~2-5s ะพั ะบะพะฝัะฐ ัะตัะธ ะดะพ ะฝะฐัะฐะปะฐ ะพัะฒะตัะฐ

### ะะฟัะธะผะธะทะฐัะธั

1. **VAD ะฟะฐัะฐะผะตััั** (ะฒ `.env`):
   - `EARLY_PAUSE_MS=350` - ะผะธะฝะธะผะฐะปัะฝะฐั ะฟะฐัะทะฐ ะดะปั ะฝะฐัะฐะปะฐ ะพะฑัะฐะฑะพัะบะธ
   - `FINAL_PAUSE_MS=1100` - ะฟะฐัะทะฐ ะดะปั ัะธะฝะฐะปะธะทะฐัะธะธ ััะฐะทั

2. **TTS ะฟะฐัะฐะผะตััั**:
   - `TTS_SPEED=0.93` - ัะบะพัะพััั ัะตัะธ (0.1-3.0)
   - `TTS_PAUSE=0.12` - ะฟะฐัะทะฐ ะผะตะถะดั ะฟัะตะดะปะพะถะตะฝะธัะผะธ
   - `REALTIME_MODE=1` - ะฒะบะปััะฐะตั ะพะฟัะธะผะธะทะฐัะธะธ ะดะปั real-time

3. **LLM ะฟะฐัะฐะผะตััั**:
   - `MAX_TOKENS=280` - ะผะฐะบัะธะผัะผ ัะพะบะตะฝะพะฒ ะฒ ะพัะฒะตัะต
   - `TEMPERATURE=0.3` - ะบัะตะฐัะธะฒะฝะพััั (0.0-1.0)

## ๐ ะฃัััะฐะฝะตะฝะธะต ะฟัะพะฑะปะตะผ

### WebSocket ะฝะต ะฟะพะดะบะปััะฐะตััั

**ะัะพะฒะตัััะต:**
```bash
# ะัะพะฒะตัะบะฐ STT Backend
curl http://127.0.0.1:8081/health

# ะัะพะฒะตัะบะฐ TTS Service
curl http://127.0.0.1:8002/health
```

**ะะตัะตะฝะธะต:**
- ะฃะฑะตะดะธัะตัั, ััะพ ะพะฑะฐ ัะตัะฒะธัะฐ ะทะฐะฟััะตะฝั
- ะัะพะฒะตัััะต, ัะฒะพะฑะพะดะฝั ะปะธ ะฟะพััั 2700 ะธ 8002
- ะะพัะผะพััะธัะต ะปะพะณะธ: `voice-backend/logs/stt.log` ะธ `voice-backend/logs/tts.log`

### ะะธะบัะพัะพะฝ ะฝะต ัะฐะฑะพัะฐะตั

**ะัะธัะธะฝั:**
1. ะัะฐัะทะตั ะฝะต ะธะผะตะตั ะดะพัััะฟะฐ ะบ ะผะธะบัะพัะพะฝั
2. HTTPS ััะตะฑัะตััั (ะบัะพะผะต localhost)
3. ะะธะบัะพัะพะฝ ะธัะฟะพะปัะทัะตััั ะดััะณะธะผ ะฟัะธะปะพะถะตะฝะธะตะผ

**ะะตัะตะฝะธะต:**
- ะัะพะฒะตัััะต ัะฐะทัะตัะตะฝะธั ะฑัะฐัะทะตัะฐ
- ะัะฟะพะปัะทัะนัะต HTTPS ะธะปะธ localhost
- ะะฐะบัะพะนัะต ะดััะณะธะต ะฟัะธะปะพะถะตะฝะธั, ะธัะฟะพะปัะทัััะธะต ะผะธะบัะพัะพะฝ

### ะะตั ะทะฒัะบะฐ

**ะัะธัะธะฝั:**
1. TTS Service ะฝะต ะทะฐะฟััะตะฝ
2. AudioContext ะทะฐะฑะปะพะบะธัะพะฒะฐะฝ ะฑัะฐัะทะตัะพะผ (autoplay policy)
3. ะะฝะพะฟะบะฐ "ะัะบะปััะธัั ะทะฒัะบ" ะฝะฐะถะฐัะฐ

**ะะตัะตะฝะธะต:**
- ะะฐะฟัััะธัะต TTS Service
- ะะปะธะบะฝะธัะต ะฝะฐ ัััะฐะฝะธัะต ะฟะตัะตะด ะฝะฐัะฐะปะพะผ ะทะฒะพะฝะบะฐ
- ะัะพะฒะตัััะต ะบะฝะพะฟะบั ะณัะพะผะบะพััะธ

### ะะปะพัะพะต ะบะฐัะตััะฒะพ ัะฐัะฟะพะทะฝะฐะฒะฐะฝะธั

**ะัะธัะธะฝั:**
1. ะจัะผะฝะฐั ััะตะดะฐ
2. ะะปะพัะพะน ะผะธะบัะพัะพะฝ
3. Vosk ะผะพะดะตะปั ะฝะต ะฟะพะดัะพะดะธั ะดะปั ะฒะฐัะตะณะพ ะฐะบัะตะฝัะฐ

**ะะตัะตะฝะธะต:**
- ะัะฟะพะปัะทัะนัะต ัะธัะพะต ะฟะพะผะตัะตะฝะธะต
- ะัะฟะพะปัะทัะนัะต ะบะฐัะตััะฒะตะฝะฝัะน ะผะธะบัะพัะพะฝ
- ะกะบะฐัะฐะนัะต ะฑะพะปะตะต ะฟัะพะดะฒะธะฝัััั Vosk ะผะพะดะตะปั:
  - `vosk-model-ru-0.42` (2.5GB) - ะปัััะตะต ะบะฐัะตััะฒะพ

### ะััะพะบะฐั ะทะฐะดะตัะถะบะฐ

**ะัะธัะธะฝั:**
1. ะะตะดะปะตะฝะฝะพะต ะธะฝัะตัะฝะตั-ัะพะตะดะธะฝะตะฝะธะต (ะดะปั DeepSeek API)
2. ะกะปะฐะฑัะน ะบะพะผะฟัััะตั
3. ะะตะพะฟัะธะผะฐะปัะฝัะต ะฟะฐัะฐะผะตััั VAD

**ะะตัะตะฝะธะต:**
- ะัะพะฒะตัััะต ัะบะพัะพััั ะธะฝัะตัะฝะตัะฐ
- ะฃะผะตะฝััะธัะต `MAX_TOKENS` ะฒ `.env`
- ะฃะผะตะฝััะธัะต `EARLY_PAUSE_MS` ะดะปั ะฑะพะปะตะต ะฑััััะพะณะพ ััะฐะฑะฐััะฒะฐะฝะธั

## ๐ ะะพะฟะพะปะฝะธัะตะปัะฝัะต ัะตััััั

- [Vosk Models](https://alphacephei.com/vosk/models)
- [Silero TTS](https://github.com/snakers4/silero-models)
- [DeepSeek API](https://platform.deepseek.com/api-docs/)
- [WebRTC](https://webrtc.org/)
- [AudioWorklet](https://developer.mozilla.org/en-US/docs/Web/API/AudioWorklet)

## ๐ฏ ะัะธะผะตัั ะธัะฟะพะปัะทะพะฒะฐะฝะธั

### ะัะพััะพะน ะทะฐะฟัะพั

**ะั:** "ะัะธะฒะตั, ะบะฐะบ ะดะตะปะฐ?"
**AI:** "ะัะธะฒะตั! ะฃ ะผะตะฝั ะฒัะต ะพัะปะธัะฝะพ, ัะฟะฐัะธะฑะพ. ะงะตะผ ะผะพะณั ะฟะพะผะพัั?"

### ะขะตัะฝะธัะตัะบะธะน ะฒะพะฟัะพั

**ะั:** "ะะฑัััะฝะธ ััะพ ัะฐะบะพะต React hooks"
**AI:** "React hooks - ััะพ ััะฝะบัะธะธ, ะบะพัะพััะต ะฟะพะทะฒะพะปััั ะธัะฟะพะปัะทะพะฒะฐัั ัะพััะพัะฝะธะต ะธ ะดััะณะธะต ะฒะพะทะผะพะถะฝะพััะธ React ะฑะตะท ะฝะฐะฟะธัะฐะฝะธั ะบะปะฐััะพะฒ..."

### ะกะพะทะดะฐะฝะธะต ะบะพะฝัะตะฝัะฐ

**ะั:** "ะะฐะฟะธัะธ ะบะพัะพัะบะพะต ััะธัะพัะฒะพัะตะฝะธะต ะฟัะพ ะทะธะผั"
**AI:** "ะกะฝะตะณ ะธัะบัะธััั ะฟะพะด ะปัะฝะพะน,
ะขะธัะพ ะฟะฐะดะฐะตั ะทะธะผะพะน.
ะะตั ัะบััะฐะฝ ะฒ ะฑะตะปัะน ะฟะปะตะด,
ะััะฐะฒะปัั ะทะฒะตะทะดะฝัะน ัะปะตะด."

## ๐ ะะตะทะพะฟะฐัะฝะพััั

- ะัะดะธะพ ะดะฐะฝะฝัะต ะพะฑัะฐะฑะฐััะฒะฐัััั ะปะพะบะฐะปัะฝะพ (Vosk)
- ะขะพะปัะบะพ ัะตะบัั ะพัะฟัะฐะฒะปัะตััั ะฒ DeepSeek API
- WebSocket ัะพะตะดะธะฝะตะฝะธะต ะฝะต ัะธัััะตััั (ะธัะฟะพะปัะทัะนัะต ัะพะปัะบะพ ะฒ ะปะพะบะฐะปัะฝะพะน ัะตัะธ)
- ะะปั ะฟัะพะดะฐะบัะตะฝะฐ ะฝะฐัััะพะนัะต HTTPS ะธ WSS (WebSocket Secure)

## ๐ ะะธัะตะฝะทะธั

MIT

## ๐ ะะพะดะดะตัะถะบะฐ

ะะพะทะฝะธะบะปะธ ะฒะพะฟัะพัั? ะกะพะทะดะฐะนัะต issue ะฒ GitHub ัะตะฟะพะทะธัะพัะธะธ ะฟัะพะตะบัะฐ.

---

**ะะฐัะปะฐะถะดะฐะนัะตัั ะณะพะปะพัะพะฒัะผ ะพะฑัะตะฝะธะตะผ ั AI! ๐**
