#!/bin/bash

# ะกะบัะธะฟั ะทะฐะฟััะบะฐ ะปะพะบะฐะปัะฝะพะณะพ TTS ัะตัะฒะตัะฐ ะดะปั WindexsAI Chat

echo "๐ ะะฐะฟััะบ ะปะพะบะฐะปัะฝะพะณะพ TTS ัะตัะฒะตัะฐ..."

# ะะตัะตัะพะดะธะผ ะฒ ะดะธัะตะบัะพัะธั ัะตัะฒะตัะฐ
cd "$(dirname "$0")/local/local/stt-vosk/backend"

# ะัะพะฒะตััะตะผ, ะทะฐะฟััะตะฝ ะปะธ ัะถะต ัะตัะฒะตั
if [ -f "../../../../tts-backend.pid" ]; then
    PID=$(cat "../../../../tts-backend.pid")
    if kill -0 "$PID" 2>/dev/null; then
        echo "โ TTS ัะตัะฒะตั ัะถะต ะทะฐะฟััะตะฝ (PID: $PID)"
        exit 0
    else
        echo "๐งน ะฃะดะฐะปัะตะผ ััะฐััะน PID ัะฐะนะป"
        rm -f "../../../../tts-backend.pid"
    fi
fi

# ะะฐะฟััะบะฐะตะผ ัะตัะฒะตั ะฒ ัะพะฝะต
echo "๐ต ะะฐะฟััะบ ัะตัะฒะตัะฐ ะฝะฐ ะฟะพััั 5001..."
python3 simple_tts_server.py &

# ะะดะตะผ ะทะฐะฟััะบะฐ
sleep 3

# ะัะพะฒะตััะตะผ, ะทะฐะฟัััะธะปัั ะปะธ ัะตัะฒะตั
if curl -s http://127.0.0.1:5001/health > /dev/null; then
    echo "โ ะะพะบะฐะปัะฝัะน TTS ัะตัะฒะตั ััะฟะตัะฝะพ ะทะฐะฟััะตะฝ!"
    echo "๐ ะะดัะตั: http://127.0.0.1:5001"
    echo "๐ ะะปั ะธัะฟะพะปัะทะพะฒะฐะฝะธั ะดะพะฑะฐะฒััะต @local ะบ ัะพะพะฑัะตะฝะธั"
else
    echo "โ ะัะธะฑะบะฐ ะทะฐะฟััะบะฐ TTS ัะตัะฒะตัะฐ"
    exit 1
fi